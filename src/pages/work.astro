---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import { Icon } from 'astro-icon/components';
import Image from '~/components/common/Image.astro';

const metadata = {
  title: 'Our Work | Legacy Exteriors Projects in Windsor-Essex',
  description: 'Browse our portfolio of excavation, drainage, driveway, trenching, and landscape preparation projects throughout Windsor and Essex County.',
};

// Gallery project categories
const categories = [
  {
    id: 'excavation',
    title: 'Excavation & Grading',
    description: 'Precision earthwork and grading for residential and commercial properties',
  },
  {
    id: 'driveways',
    title: 'Driveways',
    description: 'Custom driveway installation and repair using quality materials',
  },
  {
    id: 'drainage',
    title: 'Drainage Solutions',
    description: 'Water management systems to protect properties from water damage',
  },
  {
    id: 'trenching',
    title: 'Trenching',
    description: 'Professional trenching for utilities, drainage, and irrigation systems',
  },
  {
    id: 'landscape',
    title: 'Landscape Preparation',
    description: 'Site preparation and hardscaping for beautiful outdoor spaces',
  },
  {
    id: 'septic',
    title: 'Septic Systems',
    description: 'Installation and repair of residential and commercial septic systems',
  },
];

// Project gallery items
const projectGallery = [
  // Excavation Projects
  {
    category: 'excavation',
    image: 'https://images.unsplash.com/photo-1566041510639-8d95356b4068?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1926&q=80',
    alt: 'Residential excavation project',
    title: 'Residential Foundation Preparation',
    description: 'Complete site excavation for new home construction in Windsor',
    width: 1926,
    height: 1084
  },
  {
    category: 'excavation',
    image: 'https://images.unsplash.com/photo-1581092918056-0c4c3acd3789?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80',
    alt: 'Commercial land clearing',
    title: 'Commercial Land Clearing',
    description: 'Site preparation for new retail development in Essex County',
    width: 1740,
    height: 976
  },
  {
    category: 'excavation',
    image: 'https://images.unsplash.com/photo-1604014091681-901e7dc7a5f6?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
    alt: 'Pool excavation project',
    title: 'In-ground Pool Excavation',
    description: 'Precision digging for residential swimming pool installation',
    width: 1470,
    height: 980
  },
  
  // Driveway Projects
  {
    category: 'driveways',
    image: 'https://images.unsplash.com/photo-1597047084897-51e81819a499?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1169&q=80',
    alt: 'Concrete driveway installation',
    title: 'Concrete Driveway Installation',
    description: 'New concrete driveway with decorative finish in Tecumseh',
    width: 1169,
    height: 780
  },
  {
    category: 'driveways',
    image: 'https://images.unsplash.com/photo-1622905810727-b91c89e054da?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1074&q=80',
    alt: 'Driveway repair project',
    title: 'Driveway Repair & Resurfacing',
    description: 'Complete restoration of damaged concrete driveway in LaSalle',
    width: 1074,
    height: 716
  },
  {
    category: 'driveways',
    image: 'https://images.unsplash.com/photo-1633631651645-5ee98273b1c7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
    alt: 'Gravel driveway installation',
    title: 'Gravel Driveway Installation',
    description: 'Rural property access driveway in Essex County',
    width: 1470,
    height: 980
  },
  
  // Drainage Projects
  {
    category: 'drainage',
    image: 'https://images.unsplash.com/photo-1605059910848-7cf6dabd96ce?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80',
    alt: 'French drain installation',
    title: 'French Drain System',
    description: 'Complete perimeter drainage solution for residential property',
    width: 1740,
    height: 1160
  },
  {
    category: 'drainage',
    image: 'https://images.unsplash.com/photo-1589939705384-5185137a7f0f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
    alt: 'Surface drainage system',
    title: 'Surface Drainage Installation',
    description: 'Swale and catch basin system for water management in South Windsor',
    width: 1470,
    height: 980
  },
  {
    category: 'drainage',
    image: 'https://images.unsplash.com/photo-1562184151-c8cd69a7a71f?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1587&q=80',
    alt: 'Erosion control project',
    title: 'Erosion Control Solution',
    description: 'Comprehensive approach to prevent soil erosion on sloped property',
    width: 1587,
    height: 1058
  },
  
  // Trenching Projects
  {
    category: 'trenching',
    image: 'https://images.unsplash.com/photo-1541888946425-d81bb19240f5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80',
    alt: 'Utility trenching project',
    title: 'Utility Line Trenching',
    description: 'Precise trenching for electrical and water service to new construction',
    width: 1740,
    height: 1160
  },
  {
    category: 'trenching',
    image: 'https://images.unsplash.com/photo-1563341591-ad0a969037c9?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
    alt: 'Irrigation trenching',
    title: 'Irrigation System Trenching',
    description: 'Installation of underground irrigation lines for commercial property',
    width: 1470,
    height: 980
  },
  {
    category: 'trenching',
    image: 'https://images.unsplash.com/photo-1581026537053-aaba91a931a5?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
    alt: 'Drainage trenching',
    title: 'Drainage System Trenching',
    description: 'Installation of underground drainage pipes in Clay-heavy Windsor soil',
    width: 1470,
    height: 980
  },
  
  // Landscape Projects
  {
    category: 'landscape',
    image: 'https://images.unsplash.com/photo-1558904541-efa843a96f01?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
    alt: 'Backyard grading project',
    title: 'Complete Backyard Grading',
    description: 'Landscape preparation with proper drainage for new construction',
    width: 1470,
    height: 980
  },
  {
    category: 'landscape',
    image: 'https://images.unsplash.com/photo-1551410224-699683e15636?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1364&q=80',
    alt: 'Patio installation',
    title: 'Patio Base Preparation & Installation',
    description: 'Stone patio with proper foundation and drainage in Riverside',
    width: 1364,
    height: 909
  },
  {
    category: 'landscape',
    image: 'https://images.unsplash.com/photo-1599076480850-ac4094e95374?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80',
    alt: 'Sod installation',
    title: 'Lawn Grading & Sod Installation',
    description: 'Complete lawn renovation with proper grading and drainage',
    width: 1740,
    height: 1160
  },
  
  // Septic Projects
  {
    category: 'septic',
    image: 'https://images.unsplash.com/photo-1617155093730-a8bf47be792d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1740&q=80',
    alt: 'Septic tank installation',
    title: 'Residential Septic System',
    description: 'Complete septic system installation for rural property',
    width: 1740,
    height: 1160
  },
  {
    category: 'septic',
    image: 'https://images.unsplash.com/photo-1579389083078-4e7c25b49a21?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80',
    alt: 'Septic field installation',
    title: 'Leach Field Installation',
    description: 'Drain field system for residential septic system in Essex County',
    width: 1470,
    height: 980
  },
  {
    category: 'septic',
    image: 'https://images.unsplash.com/photo-1621118209566-e17b2593e1f8?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1587&q=80',
    alt: 'Commercial septic system',
    title: 'Commercial Septic Installation',
    description: 'Large-scale septic system for business property in rural Windsor-Essex',
    width: 1587,
    height: 1058
  },
];
---

<Layout metadata={metadata}>
  <!-- Hero Widget ******************* -->
  <Hero
    tagline="Our Portfolio"
    title="Transforming Windsor-Essex"
    subtitle="Browse our collection of excavation, drainage, driveway, trenching, and landscaping projects throughout Windsor and Essex County."
    actions={[
      {
        variant: 'primary',
        text: 'Contact Us For Your Project',
        href: '/contact',
        icon: 'tabler:message',
      },
    ]}
    image={{
      src: 'https://images.unsplash.com/photo-1566041510639-8d95356b4068?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1926&q=80',
      alt: 'Legacy Exteriors excavation project',
    }}
  >
    <Fragment slot="bg">
      <div class="absolute inset-0 bg-gradient-to-tr from-gray-900/80 via-transparent to-gray-900/80"></div>
    </Fragment>
  </Hero>

  <!-- Category Filters -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8 mb-4">
    <div class="text-center mb-8">
      <h2 class="text-3xl font-bold mb-4">Project Categories</h2>
      <p class="text-xl text-muted dark:text-slate-400 max-w-3xl mx-auto">
        Filter our work by service category to find examples relevant to your needs
      </p>
    </div>
    
    <div class="flex flex-wrap justify-center gap-2 my-8" id="category-filters">
      <button 
        class="filter-btn active px-4 py-2 rounded-md bg-primary text-white font-medium hover:bg-primary/80 transition-colors" 
        data-category="all"
      >
        All Projects
      </button>
      
      {categories.map(category => (
        <button 
          class="filter-btn px-4 py-2 rounded-md bg-gray-200 dark:bg-slate-700 font-medium hover:bg-gray-300 dark:hover:bg-slate-600 transition-colors" 
          data-category={category.id}
        >
          {category.title}
        </button>
      ))}
    </div>
  </div>

  <!-- Projects Gallery -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 pb-16">
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 pswp-gallery" id="projects-grid">
      {projectGallery.map((project, index) => (
        <figure 
          class={`project-item ${project.category} relative rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-all duration-300 group aspect-video bg-gray-200 dark:bg-slate-800`}
          itemscope 
          itemtype="http://schema.org/ImageObject"
        >
          <a 
            href={project.image}
            data-pswp-width={project.width}
            data-pswp-height={project.height}
            class="block"
          >
            <Image
              src={project.image}
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500 ease-in-out"
              alt={project.alt}
              width={600}
              height={400}
              widths={[400, 600, 800]}
              loading={index < 6 ? 'eager' : 'lazy'}
              decoding="async"
            />
            <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-colors duration-300"></div>
            
            <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/70 to-transparent p-4">
              <h3 class="text-white text-lg font-bold" itemprop="name">{project.title}</h3>
              <p class="text-white/90 text-sm mt-1" itemprop="description">{project.description}</p>
              
              <span class="absolute top-4 right-4 bg-primary text-white text-xs px-2 py-1 rounded-md font-medium">
                {categories.find(cat => cat.id === project.category)?.title || project.category}
              </span>
            </div>
          </a>
          
          <figcaption itemprop="caption description" class="hidden">
            {project.description}
          </figcaption>
        </figure>
      ))}
    </div>

    <!-- Empty State for Filtered Results -->
    <div id="no-results" class="hidden text-center py-16 bg-gray-100 dark:bg-slate-800 rounded-lg my-8">
      <Icon name="tabler:photo-off" class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-600 mb-4" />
      <h3 class="text-2xl font-bold text-gray-800 dark:text-white mb-2">No Projects Found</h3>
      <p class="text-muted dark:text-slate-400 mb-4">No projects match the selected category.</p>
      <button id="reset-filters" class="btn-primary px-4 py-2 rounded-md">
        Show All Projects
      </button>
    </div>
  </div>

  <!-- CallToAction Widget *********** -->
  <CallToAction
    tagline="Ready to start your project?"
    backgroundImage="https://images.unsplash.com/photo-1558904541-efa843a96f01?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80"
    overlayOpacity={0.7}
    showLeaves={false}
    actions={[
      {
        variant: 'primary',
        text: 'Request a Free Quote',
        href: '/contact',
        icon: 'tabler:message',
      },
      {
        variant: 'secondary',
        text: 'Explore Our Services',
        href: '/services',
      },
    ]}
    isDark={true}
  >
    <Fragment slot="title">
      Let Us Bring Your Vision <br class="block sm:hidden" /><span class="sm:whitespace-nowrap">To Life</span>
    </Fragment>

    <Fragment slot="subtitle">
      Contact us today to discuss your project needs and get a free, no-obligation quote.
      <br class="hidden md:inline" />Our team is ready to help transform your property with professional excavation and landscaping services.
    </Fragment>
  </CallToAction>
</Layout>

<!-- PhotoSwipe initialization script -->
<script>
  // Import required PhotoSwipe modules
  import PhotoSwipe from 'photoswipe';
  import PhotoSwipeLightbox from 'photoswipe/lightbox';
  import 'photoswipe/style.css';

  // Wait for the DOM to be fully loaded
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize PhotoSwipe
    const lightbox = new PhotoSwipeLightbox({
      gallery: '.pswp-gallery',
      children: 'a',
      pswpModule: PhotoSwipe
    });

    lightbox.init();

    // Set up category filtering
    setupFiltering();
  });

  function setupFiltering() {
    // Type-safe element selection
    const filterButtons = document.querySelectorAll<HTMLButtonElement>('.filter-btn');
    const projectItems = document.querySelectorAll<HTMLElement>('.project-item');
    const noResultsEl = document.getElementById('no-results');
    const projectsGridEl = document.getElementById('projects-grid');
    const resetFiltersBtn = document.getElementById('reset-filters');

    // Handle filtering
    filterButtons.forEach(button => {
      button.addEventListener('click', () => {
        // Update active button styling
        filterButtons.forEach(btn => {
          btn.classList.remove('active', 'bg-primary', 'text-white');
          btn.classList.add('bg-gray-200', 'dark:bg-slate-700');
        });
        
        button.classList.add('active', 'bg-primary', 'text-white');
        button.classList.remove('bg-gray-200', 'dark:bg-slate-700');
        
        const category = button.getAttribute('data-category') || '';
        let visibleCount = 0;
        
        projectItems.forEach(item => {
          if (category === 'all' || item.classList.contains(category)) {
            item.style.display = '';
            visibleCount++;
          } else {
            item.style.display = 'none';
          }
        });
        
        // Show/hide empty state
        if (visibleCount === 0 && noResultsEl && projectsGridEl) {
          noResultsEl.classList.remove('hidden');
          projectsGridEl.classList.add('hidden');
        } else if (noResultsEl && projectsGridEl) {
          noResultsEl.classList.add('hidden');
          projectsGridEl.classList.remove('hidden');
        }
      });
    });
    
    // Reset button functionality
    if (resetFiltersBtn) {
      resetFiltersBtn.addEventListener('click', () => {
        const allButton = document.querySelector<HTMLButtonElement>('[data-category="all"]');
        if (allButton) {
          // Use the built-in click() method on the element
          allButton.click();
        }
      });
    }
  }
</script>

<style>
  .filter-btn.active {
    position: relative;
  }
  
  .filter-btn.active::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 50%;
    transform: translateX(-50%);
    width: 20px;
    height: 2px;
    background-color: currentColor;
    border-radius: 2px;
  }
  
  /* Add styles for PhotoSwipe gallery */
  .pswp-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.5rem;
  }
  
  .project-item {
    aspect-ratio: 4/3;
    position: relative;
    cursor: pointer;
  }
</style>